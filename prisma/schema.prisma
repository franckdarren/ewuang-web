datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model article_commandes {
  id          String   @id @default(uuid()) @db.Uuid
  article_id  String   @db.Uuid
  commande_id String   @db.Uuid
  quantite    Int
  prix        Int
  reduction   Int
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())

  // Relations
  articles  articles  @relation(fields: [article_id], references: [id])
  commandes commandes @relation(fields: [commande_id], references: [id])

  @@index([article_id])
  @@index([commande_id])
}

model articles {
  id                    String    @id @default(uuid()) @db.Uuid
  nom                   String    @db.VarChar(255)
  description           String?   @db.VarChar(255)
  prix                  Int
  prix_promotion        Int?
  is_promotion          Boolean   @default(false)
  pourcentage_reduction Int       @default(0)
  made_in_gabon         Boolean   @default(false)
  user_id               String    @db.Uuid
  categorie             String    @db.VarChar(255)
  image_principale      String?   @db.VarChar(255)
  created_at            DateTime? @default(now())
  updated_at            DateTime? @updatedAt

  // Relations
  article_commandes article_commandes[]
  commande_articles commande_articles[]
  image_articles    image_articles[]
  variations        variations[]
  users             users               @relation(fields: [user_id], references: [id])

  @@index([user_id])
}

model commande_articles {
  id            String   @id @default(uuid()) @db.Uuid
  commande_id   String   @db.Uuid
  article_id    String   @db.Uuid
  variation_id  String?  @db.Uuid
  quantite      Int
  prix_unitaire Int
  created_at    DateTime @default(now())
  updated_at    DateTime @default(now())

  articles   articles    @relation(fields: [article_id], references: [id])
  commandes  commandes   @relation(fields: [commande_id], references: [id])
  variations variations? @relation(fields: [variation_id], references: [id])

  @@index([article_id])
  @@index([commande_id])
  @@index([variation_id])
}

model commandes {
  id                String           @id @default(uuid()) @db.Uuid
  numero            String           @db.VarChar(255)
  statut            commandes_statut @default(en_attente)
  prix              Int
  commentaire       String           @db.VarChar(255)
  isLivrable        Boolean
  user_id           String           @db.Uuid
  created_at        DateTime         @default(now())
  updated_at        DateTime         @updatedAt
  adresse_livraison String           @db.VarChar(255)

  // Relations
  article_commandes article_commandes[]
  commande_articles commande_articles[]
  users             users               @relation(fields: [user_id], references: [id])
  livraisons        livraisons[]
  reclamations      reclamations[]

  @@index([user_id])
}

model image_articles {
  id           String   @id @default(uuid()) @db.Uuid
  url_photo    String   @db.VarChar(255)
  variation_id String?  @db.Uuid
  article_id   String   @db.Uuid
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())

  articles   articles    @relation(fields: [article_id], references: [id])
  variations variations? @relation(fields: [variation_id], references: [id])

  @@index([article_id])
  @@index([variation_id])
}

model livraisons {
  id             String   @id @default(uuid()) @db.Uuid
  adresse        String   @db.VarChar(255)
  details        String   @db.VarChar(255)
  statut         String   @db.VarChar(255)
  date_livraison DateTime
  ville          String   @db.VarChar(255)
  phone          String   @db.VarChar(255)
  commande_id    String   @db.Uuid
  user_id        String?  @db.Uuid
  created_at     DateTime @default(now())
  updated_at     DateTime @default(now())

  commandes commandes @relation(fields: [commande_id], references: [id])
  users     users?    @relation(fields: [user_id], references: [id])

  @@index([commande_id])
  @@index([user_id])
}

model publicites {
  id          String   @id @default(uuid()) @db.Uuid
  date_start  DateTime
  date_end    DateTime
  titre       String   @db.VarChar(255)
  url_image   String   @db.VarChar(255)
  lien        String   @db.VarChar(255)
  description String
  is_actif    Boolean
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())
}

model reclamations {
  id          String              @id @default(uuid()) @db.Uuid
  description String              @db.VarChar(255)
  phone       String              @db.VarChar(255)
  statut      reclamations_statut @default(en_attente_de_traitement)
  commande_id String              @db.Uuid
  user_id     String              @db.Uuid
  created_at  DateTime            @default(now())
  updated_at  DateTime            @updatedAt

  commandes commandes @relation(fields: [commande_id], references: [id])
  users     users     @relation(fields: [user_id], references: [id])

  @@index([commande_id])
  @@index([user_id])
}

model stocks {
  id           String   @id @default(uuid()) @db.Uuid
  variation_id String   @db.Uuid
  quantite     Int      @default(0)
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())

  variations variations @relation(fields: [variation_id], references: [id])

  @@index([variation_id])
}

model users {
  id              String   @id @default(uuid()) @db.Uuid
  auth_id         String?  @unique @db.Uuid
  name            String   @db.VarChar(255)
  role            String   @db.VarChar(255)
  email           String   @unique @db.VarChar(255)
  url_logo        String?  @db.VarChar(255)
  phone           String?  @db.VarChar(255)
  heure_ouverture String?
  heure_fermeture String?
  description     String?
  address         String?
  solde           Int      @default(0)
  created_at      DateTime @default(now())
  updated_at      DateTime @default(now())

  articles     articles[]
  commandes    commandes[]
  livraisons   livraisons[]
  reclamations reclamations[]
}

model variations {
  id         String    @id @default(uuid()) @db.Uuid
  article_id String    @db.Uuid
  couleur    String?   @db.VarChar(255)
  taille     String?   @db.VarChar(255)
  stock      Int       @default(0)
  prix       Int?
  image      String?   @db.VarChar(255)
  created_at DateTime? @default(now())
  updated_at DateTime? @updatedAt

  commande_articles commande_articles[]
  image_articles    image_articles[]
  stocks            stocks[]
  articles          articles            @relation(fields: [article_id], references: [id])

  @@index([article_id])
}

enum commandes_statut {
  en_attente            @map("En attente")
  en_preparation        @map("En préparation")
  prete_pour_livraison  @map("Prête pour livraison")
  en_cours_de_livraison @map("En cours de livraison")
  livree                @map("Livrée")
  annule                @map("Annulée")
  rembourse             @map("Remboursée")
}

enum reclamations_statut {
  en_attente_de_traitement @map("En attente de traitement")
  en_cours                 @map("En cours")
  rejete                   @map("Rejetée")
  rembourse                @map("Remboursée")
}
